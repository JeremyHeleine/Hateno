#!/usr/bin/env python3
# -*- coding: utf-8 -*-

'''
This scripts runs the server part of a job.
'''

import argparse

from hateno.job import JobServer
from hateno.utils import jsonfiles

def addArguments(parser):
	parser.add_argument('--log', type = str, help = 'log file to write')
	parser.add_argument('cmd_list', type = str, help = 'path to the file where the command lines are stored')
	parser.add_argument('job_dir', type = str, help = 'path to the job directory that will be created to store the messaging files')

def main(args):
	with JobServer(args.cmd_list, args.job_dir) as server:
		server.run()

		if args.log is not None:
			jsonfiles.write(server.log, args.log)

if __name__ == '__main__':
	parser = argparse.ArgumentParser(description = 'Run the server part of a job')
	addArguments(parser)
	main(parser.parse_args())
