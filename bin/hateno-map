#!/usr/bin/env python3
# -*- coding: utf-8 -*-

'''
This script uses the Mapper to map simulations with evaluation functions.
'''

import argparse

from hateno import jsonfiles
from hateno.mapper import Mapper

def addArguments(parser):
	parser.add_argument('--config', type = str, help = 'name of the config to use')
	parser.add_argument('--add-to-manager', action = 'store_true', help = 'add the generated simulations to the manager')
	parser.add_argument('folder_path', type = str, help = 'path to the simulations folder')
	parser.add_argument('tree', type = str, help = 'path to the file describing the tree to map')
	parser.add_argument('output', type = str, help = 'path to the file where the output should be written')

def action(args):
	with Mapper(args.folder_path, args.config, generate_only = not(args.add_to_manager)) as mapper:
		output = mapper.mapTree(jsonfiles.read(args.tree, allow_generator = True))
		jsonfiles.write(output, args.output)

if __name__ == '__main__':
	parser = argparse.ArgumentParser(description = 'Map simulations.')
	addArguments(parser)
	action(parser.parse_args())
